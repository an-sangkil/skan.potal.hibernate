<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd">

<!-- 스케쥴관리  -->
<sqlMap namespace="system.code">

	<typeAlias alias="code" type="com.dongbu.farm.system.code.model.Code"/>
	<typeAlias alias="codeSearchCondition" type="com.dongbu.farm.common.tags.CodeSearchCondition"/>
	
	<select id="getCodeDetail" parameterClass="java.util.HashMap" resultClass="code">
		SELECT code_mgt_no
	      ,upper_code
	      ,cmfn_codename(upper_code) as upper_code_name
	      ,code_seq
	      ,code
	      ,code_name
	      ,code_comment
	      ,creator
	      ,createdtime
	      ,modifier
	      ,modifiedtime
	  FROM cmtb_code
	  WHERE 1=1
	  AND code = #code#
	</select>
	
	<insert id="writeCode" parameterClass="code">
		<selectKey keyProperty="code_mgt_no" type="pre" resultClass="String">
			SELECT ISNULL(MAX(CAST(code_mgt_no AS INTEGER))+1, 1) AS code_mgt_no FROM  cmtb_code	
		</selectKey>
		
		INSERT cmtb_code(
		   code_mgt_no
	      ,upper_code
	      ,code_seq
	      ,code
	      ,code_name
	      ,code_comment
	      ,creator
	      ,createdtime
	      ,modifier
	      ,modifiedtime)
	   VALUES(
	   	   #code_mgt_no#
	      ,#upper_code#
	      ,#code_seq#
	      ,(select f_rpad(MAX(IFNULL(code,0))+1,5,'0') as code from cmtb_code)
	      ,#code_name#
	      ,#code_comment#
	      ,#creator#
	      ,#createdtime#
	      ,#modifier#
	      ,#modifiedtime#
	   )
	</insert>
	
	<update id="modifyCode" parameterClass="code">
		UPDATE cmtb_code
			SET
			     UPPER_CODE      = #upper_code#,         
			     CODE_SEQ        = #code_seq#,             
			     CODE_NAME       = #code_name#,            
			     CODE_COMMENT    = #code_comment#,         
			     MODIFIER        = #modifier#,             
			     MODIFIEDTIME    = #modifiedtime#
		WHERE CODE = #code#         
	</update>
	
	<!-- 테그라이브러리에서 사용하는.. -->
	<select id="getCodeList" parameterClass="codeSearchCondition" resultClass="code">
		SELECT CODE_mgt_no
	      ,upper_code
	      ,cmfn_codename(upper_code) as upper_code_name
	      ,code_seq
	      ,code
	      ,code_name
	      ,code_comment
	      ,creator
	      ,createdtime
	      ,modifier
	      ,modifiedtime
	  FROM cmtb_code
	  WHERE 1=1
	  AND upper_code = #groupCode#
	</select>
	
</sqlMap>